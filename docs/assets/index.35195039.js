var ue=Object.defineProperty,le=Object.defineProperties;var fe=Object.getOwnPropertyDescriptors;var ft=Object.getOwnPropertySymbols;var pe=Object.prototype.hasOwnProperty,he=Object.prototype.propertyIsEnumerable;var X=(e,n,t)=>n in e?ue(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,k=(e,n)=>{for(var t in n||(n={}))pe.call(n,t)&&X(e,t,n[t]);if(ft)for(var t of ft(n))he.call(n,t)&&X(e,t,n[t]);return e},pt=(e,n)=>le(e,fe(n));var ye=(e,n)=>()=>(n||e((n={exports:{}}).exports,n),n.exports);var p=(e,n,t)=>(X(e,typeof n!="symbol"?n+"":n,t),t);var Qo=ye((w,_)=>{const me=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerpolicy&&(i.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?i.credentials="include":o.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=t(o);fetch(o.href,i)}};me();var jt={exports:{}};(function(e){var n=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function o(c,d,u){this.fn=c,this.context=d,this.once=u||!1}function i(c,d,u,l,g){if(typeof u!="function")throw new TypeError("The listener must be a function");var m=new o(u,l||c,g),h=t?t+d:d;return c._events[h]?c._events[h].fn?c._events[h]=[c._events[h],m]:c._events[h].push(m):(c._events[h]=m,c._eventsCount++),c}function a(c,d){--c._eventsCount===0?c._events=new r:delete c._events[d]}function s(){this._events=new r,this._eventsCount=0}s.prototype.eventNames=function(){var d=[],u,l;if(this._eventsCount===0)return d;for(l in u=this._events)n.call(u,l)&&d.push(t?l.slice(1):l);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(u)):d},s.prototype.listeners=function(d){var u=t?t+d:d,l=this._events[u];if(!l)return[];if(l.fn)return[l.fn];for(var g=0,m=l.length,h=new Array(m);g<m;g++)h[g]=l[g].fn;return h},s.prototype.listenerCount=function(d){var u=t?t+d:d,l=this._events[u];return l?l.fn?1:l.length:0},s.prototype.emit=function(d,u,l,g,m,h){var S=t?t+d:d;if(!this._events[S])return!1;var f=this._events[S],T=arguments.length,x,v;if(f.fn){switch(f.once&&this.removeListener(d,f.fn,void 0,!0),T){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,u),!0;case 3:return f.fn.call(f.context,u,l),!0;case 4:return f.fn.call(f.context,u,l,g),!0;case 5:return f.fn.call(f.context,u,l,g,m),!0;case 6:return f.fn.call(f.context,u,l,g,m,h),!0}for(v=1,x=new Array(T-1);v<T;v++)x[v-1]=arguments[v];f.fn.apply(f.context,x)}else{var de=f.length,L;for(v=0;v<de;v++)switch(f[v].once&&this.removeListener(d,f[v].fn,void 0,!0),T){case 1:f[v].fn.call(f[v].context);break;case 2:f[v].fn.call(f[v].context,u);break;case 3:f[v].fn.call(f[v].context,u,l);break;case 4:f[v].fn.call(f[v].context,u,l,g);break;default:if(!x)for(L=1,x=new Array(T-1);L<T;L++)x[L-1]=arguments[L];f[v].fn.apply(f[v].context,x)}}return!0},s.prototype.on=function(d,u,l){return i(this,d,u,l,!1)},s.prototype.once=function(d,u,l){return i(this,d,u,l,!0)},s.prototype.removeListener=function(d,u,l,g){var m=t?t+d:d;if(!this._events[m])return this;if(!u)return a(this,m),this;var h=this._events[m];if(h.fn)h.fn===u&&(!g||h.once)&&(!l||h.context===l)&&a(this,m);else{for(var S=0,f=[],T=h.length;S<T;S++)(h[S].fn!==u||g&&!h[S].once||l&&h[S].context!==l)&&f.push(h[S]);f.length?this._events[m]=f.length===1?f[0]:f:a(this,m)}return this},s.prototype.removeAllListeners=function(d){var u;return d?(u=t?t+d:d,this._events[u]&&a(this,u)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=t,s.EventEmitter=s,e.exports=s})(jt);var G=jt.exports,U,ge=new Uint8Array(16);function ve(){if(!U&&(U=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!U))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return U(ge)}var be=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function we(e){return typeof e=="string"&&be.test(e)}var b=[];for(var W=0;W<256;++W)b.push((W+256).toString(16).substr(1));function _e(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(b[e[n+0]]+b[e[n+1]]+b[e[n+2]]+b[e[n+3]]+"-"+b[e[n+4]]+b[e[n+5]]+"-"+b[e[n+6]]+b[e[n+7]]+"-"+b[e[n+8]]+b[e[n+9]]+"-"+b[e[n+10]]+b[e[n+11]]+b[e[n+12]]+b[e[n+13]]+b[e[n+14]]+b[e[n+15]]).toLowerCase();if(!we(t))throw TypeError("Stringified UUID is invalid");return t}function Dt(e,n,t){e=e||{};var r=e.random||(e.rng||ve)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,n){t=t||0;for(var o=0;o<16;++o)n[t+o]=r[o];return n}return _e(r)}class ht{constructor(n){p(this,"afters",[]);this.id=n}}function Se(e){const n={},t=[],r={};e.forEach(i=>{const a=i[0],s=i[1];n[a]||(n[a]=new ht(a)),n[s]||(n[s]=new ht(s)),n[a].afters.push(s)});const o=(i,a=[])=>{const s=n[i],c=s.id;r[i]||(Array.isArray(a)||(a=[]),a.push(c),r[i]=!0,s.afters.forEach(d=>{if(a.indexOf(d)>=0)throw new Error(`closed chain : ${d} is in ${c}`);o(d.toString(),a.slice(0))}),t.unshift(c))};return Object.keys(n).forEach(i=>{o(i)}),t}const N={entityAdd:"entity:add",entityRemove:"entity:remove"};class Ie extends G{constructor(t,r){super();p(this,"entityIds",new Set);p(this,"events",[]);this.componentNames=t,this.world=r,this.indexeEntities();const o=a=>{a.entity.findComponents(this.componentNames).filter(s=>!!s).length===this.componentNames.length&&(this.entityIds.add(a.entity.id),this.emit(N.entityAdd,a.entity.id))},i=a=>{this.entityIds.delete(a.id),this.emit(N.entityRemove,a.id)};this.world.on(N.entityAdd,o),this.world.on(N.entityRemove,i),this.events.push(()=>{this.world.off(N.entityAdd,o)}),this.events.push(()=>{this.world.off(N.entityRemove,i)})}indexeEntities(){const t=this.world.queryEntitiesByComponents(this.componentNames).map(r=>r.id);this.entityIds=new Set(t)}dispose(){this.events.forEach(t=>t()),this.events.length=0}}function yt(e,n){return e.every(t=>n.includes(t))}function mt(e){return e.reduce((n,t)=>{const[r,o]=t.split(":");return n[r]=o||r,n},{})}function rt(e){return`${e.componentName}::${e.entityId}`}class Ee{constructor(n,t){p(this,"id");p(this,"updated",!1);this.opt=n,this.world=t,this.id=this.opt.id||Dt()}init(){for(const n of this.opt.components||[])this.addComponent({componentName:n.componentName,initialData:n.data,importData:this.opt.importData})}get components(){const n=new RegExp(this.id);return Object.keys(this.world.componentInstances).filter(t=>n.test(t))}addChild(n){n.tags=n.tags||[],n.tags.push(`parent:${this.id}`),this.world.addEntity(n)}children(){const n=`parent:${this.id}`;return Object.values(this.world.entities).filter(t=>{var r;return(r=t.opt.tags)==null?void 0:r.includes(n)})}hasParent(){return!!this.getParentId()}getParentId(){return mt(this.opt.tags||[]).parent}moveToParent(n){if(!this.world.findEntityById(n))throw new Error(`moveToParent: parent ${n} is not found`);const r=mt(this.opt.tags||[]);r.parent!==n&&(this.removeTag(`parent:${r.parent}`),this.addTag(`parent:${n}`),this.world.emit("entity:parent:change",{id:this.id,fromParent:r.parent,toParent:n}))}findComponents(n){return n.reduce((t,r)=>{const o=rt({componentName:r,entityId:this.id}),i=this.world.componentInstances[o];return t.push(i),t},[])}addComponent({componentName:n,initialData:t,importData:r=!1}){const[o]=this.findComponents([n]);if(o&&(console.warn(`Entity: component ${n} is already added, overwrite data`),r)){console.log("importing data for component",n),o.setData(t,!0);return}this.world.addComponentToEntity({componentName:n,data:t,entityId:this.id,importData:r})}removeComponent(n){return this.world.removeComponentFromEntity({componentName:n,entityId:this.id})}disposeComponents(){const n=new RegExp(this.id);for(const t of Object.keys(this.world.componentInstances))n.test(t)&&this.world.removeComponentFromEntity({componentId:t,entityId:this.id})}addTag(n){const t=new Set(this.opt.tags);t.has(n)||(t.add(n),this.opt.tags=[...t],this.world.emit("entity:tag:add",{id:this.id,tag:n}))}removeTag(n){const t=new Set(this.opt.tags);t.has(n)||(t.delete(n),this.opt.tags=[...t],this.world.emit("entity:tag:remove",{id:this.id,tag:n}))}dispose(){this.children().forEach(n=>n.dispose()),this.disposeComponents(),this.world.removeEntityById(this.id)}toJSON(){return this.world.exportEntity(this)}}var Te=typeof global=="object"&&global&&global.Object===Object&&global,Bt=Te,Oe=typeof self=="object"&&self&&self.Object===Object&&self,xe=Bt||Oe||Function("return this")(),j=xe,Ae=j.Symbol,C=Ae,Lt=Object.prototype,$e=Lt.hasOwnProperty,Ne=Lt.toString,R=C?C.toStringTag:void 0;function Ce(e){var n=$e.call(e,R),t=e[R];try{e[R]=void 0;var r=!0}catch{}var o=Ne.call(e);return r&&(n?e[R]=t:delete e[R]),o}var Pe=Object.prototype,je=Pe.toString;function De(e){return je.call(e)}var Be="[object Null]",Le="[object Undefined]",gt=C?C.toStringTag:void 0;function q(e){return e==null?e===void 0?Le:Be:gt&&gt in Object(e)?Ce(e):De(e)}function D(e){return e!=null&&typeof e=="object"}var Re="[object Symbol]";function ot(e){return typeof e=="symbol"||D(e)&&q(e)==Re}function Me(e,n){for(var t=-1,r=e==null?0:e.length,o=Array(r);++t<r;)o[t]=n(e[t],t,e);return o}var Fe=Array.isArray,P=Fe,qe=1/0,vt=C?C.prototype:void 0,bt=vt?vt.toString:void 0;function Rt(e){if(typeof e=="string")return e;if(P(e))return Me(e,Rt)+"";if(ot(e))return bt?bt.call(e):"";var n=e+"";return n=="0"&&1/e==-qe?"-0":n}function I(e){var n=typeof e;return e!=null&&(n=="object"||n=="function")}function Mt(e){return e}var ze="[object AsyncFunction]",Ue="[object Function]",He="[object GeneratorFunction]",Ge="[object Proxy]";function it(e){if(!I(e))return!1;var n=q(e);return n==Ue||n==He||n==ze||n==Ge}var Ke=j["__core-js_shared__"],Y=Ke,wt=function(){var e=/[^.]+$/.exec(Y&&Y.keys&&Y.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function Je(e){return!!wt&&wt in e}var Ve=Function.prototype,Xe=Ve.toString;function ke(e){if(e!=null){try{return Xe.call(e)}catch{}try{return e+""}catch{}}return""}var We=/[\\^$.*+?()[\]{}|]/g,Ye=/^\[object .+?Constructor\]$/,Ze=Function.prototype,Qe=Object.prototype,tn=Ze.toString,en=Qe.hasOwnProperty,nn=RegExp("^"+tn.call(en).replace(We,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function rn(e){if(!I(e)||Je(e))return!1;var n=it(e)?nn:Ye;return n.test(ke(e))}function on(e,n){return e==null?void 0:e[n]}function st(e,n){var t=on(e,n);return rn(t)?t:void 0}var _t=Object.create,sn=function(){function e(){}return function(n){if(!I(n))return{};if(_t)return _t(n);e.prototype=n;var t=new e;return e.prototype=void 0,t}}(),an=sn;function cn(e,n,t){switch(t.length){case 0:return e.call(n);case 1:return e.call(n,t[0]);case 2:return e.call(n,t[0],t[1]);case 3:return e.call(n,t[0],t[1],t[2])}return e.apply(n,t)}function dn(e,n){var t=-1,r=e.length;for(n||(n=Array(r));++t<r;)n[t]=e[t];return n}var un=800,ln=16,fn=Date.now;function pn(e){var n=0,t=0;return function(){var r=fn(),o=ln-(r-t);if(t=r,o>0){if(++n>=un)return arguments[0]}else n=0;return e.apply(void 0,arguments)}}function hn(e){return function(){return e}}var yn=function(){try{var e=st(Object,"defineProperty");return e({},"",{}),e}catch{}}(),H=yn,mn=H?function(e,n){return H(e,"toString",{configurable:!0,enumerable:!1,value:hn(n),writable:!0})}:Mt,gn=mn,vn=pn(gn),bn=vn,wn=9007199254740991,_n=/^(?:0|[1-9]\d*)$/;function at(e,n){var t=typeof e;return n=n==null?wn:n,!!n&&(t=="number"||t!="symbol"&&_n.test(e))&&e>-1&&e%1==0&&e<n}function ct(e,n,t){n=="__proto__"&&H?H(e,n,{configurable:!0,enumerable:!0,value:t,writable:!0}):e[n]=t}function K(e,n){return e===n||e!==e&&n!==n}var Sn=Object.prototype,In=Sn.hasOwnProperty;function Ft(e,n,t){var r=e[n];(!(In.call(e,n)&&K(r,t))||t===void 0&&!(n in e))&&ct(e,n,t)}function En(e,n,t,r){var o=!t;t||(t={});for(var i=-1,a=n.length;++i<a;){var s=n[i],c=r?r(t[s],e[s],s,t,e):void 0;c===void 0&&(c=e[s]),o?ct(t,s,c):Ft(t,s,c)}return t}var St=Math.max;function Tn(e,n,t){return n=St(n===void 0?e.length-1:n,0),function(){for(var r=arguments,o=-1,i=St(r.length-n,0),a=Array(i);++o<i;)a[o]=r[n+o];o=-1;for(var s=Array(n+1);++o<n;)s[o]=r[o];return s[n]=t(a),cn(e,this,s)}}function On(e,n){return bn(Tn(e,n,Mt),e+"")}var xn=9007199254740991;function qt(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=xn}function dt(e){return e!=null&&qt(e.length)&&!it(e)}function An(e,n,t){if(!I(t))return!1;var r=typeof n;return(r=="number"?dt(t)&&at(n,t.length):r=="string"&&n in t)?K(t[n],e):!1}function $n(e){return On(function(n,t){var r=-1,o=t.length,i=o>1?t[o-1]:void 0,a=o>2?t[2]:void 0;for(i=e.length>3&&typeof i=="function"?(o--,i):void 0,a&&An(t[0],t[1],a)&&(i=o<3?void 0:i,o=1),n=Object(n);++r<o;){var s=t[r];s&&e(n,s,r,i)}return n})}var Nn=Object.prototype;function zt(e){var n=e&&e.constructor,t=typeof n=="function"&&n.prototype||Nn;return e===t}function Cn(e,n){for(var t=-1,r=Array(e);++t<e;)r[t]=n(t);return r}var Pn="[object Arguments]";function It(e){return D(e)&&q(e)==Pn}var Ut=Object.prototype,jn=Ut.hasOwnProperty,Dn=Ut.propertyIsEnumerable,Bn=It(function(){return arguments}())?It:function(e){return D(e)&&jn.call(e,"callee")&&!Dn.call(e,"callee")},tt=Bn;function Ln(){return!1}var Ht=typeof w=="object"&&w&&!w.nodeType&&w,Et=Ht&&typeof _=="object"&&_&&!_.nodeType&&_,Rn=Et&&Et.exports===Ht,Tt=Rn?j.Buffer:void 0,Mn=Tt?Tt.isBuffer:void 0,Fn=Mn||Ln,Gt=Fn,qn="[object Arguments]",zn="[object Array]",Un="[object Boolean]",Hn="[object Date]",Gn="[object Error]",Kn="[object Function]",Jn="[object Map]",Vn="[object Number]",Xn="[object Object]",kn="[object RegExp]",Wn="[object Set]",Yn="[object String]",Zn="[object WeakMap]",Qn="[object ArrayBuffer]",tr="[object DataView]",er="[object Float32Array]",nr="[object Float64Array]",rr="[object Int8Array]",or="[object Int16Array]",ir="[object Int32Array]",sr="[object Uint8Array]",ar="[object Uint8ClampedArray]",cr="[object Uint16Array]",dr="[object Uint32Array]",y={};y[er]=y[nr]=y[rr]=y[or]=y[ir]=y[sr]=y[ar]=y[cr]=y[dr]=!0;y[qn]=y[zn]=y[Qn]=y[Un]=y[tr]=y[Hn]=y[Gn]=y[Kn]=y[Jn]=y[Vn]=y[Xn]=y[kn]=y[Wn]=y[Yn]=y[Zn]=!1;function ur(e){return D(e)&&qt(e.length)&&!!y[q(e)]}function lr(e){return function(n){return e(n)}}var Kt=typeof w=="object"&&w&&!w.nodeType&&w,M=Kt&&typeof _=="object"&&_&&!_.nodeType&&_,fr=M&&M.exports===Kt,Z=fr&&Bt.process,pr=function(){try{var e=M&&M.require&&M.require("util").types;return e||Z&&Z.binding&&Z.binding("util")}catch{}}(),Ot=pr,xt=Ot&&Ot.isTypedArray,hr=xt?lr(xt):ur,Jt=hr,yr=Object.prototype,mr=yr.hasOwnProperty;function gr(e,n){var t=P(e),r=!t&&tt(e),o=!t&&!r&&Gt(e),i=!t&&!r&&!o&&Jt(e),a=t||r||o||i,s=a?Cn(e.length,String):[],c=s.length;for(var d in e)(n||mr.call(e,d))&&!(a&&(d=="length"||o&&(d=="offset"||d=="parent")||i&&(d=="buffer"||d=="byteLength"||d=="byteOffset")||at(d,c)))&&s.push(d);return s}function vr(e,n){return function(t){return e(n(t))}}function br(e){var n=[];if(e!=null)for(var t in Object(e))n.push(t);return n}var wr=Object.prototype,_r=wr.hasOwnProperty;function Sr(e){if(!I(e))return br(e);var n=zt(e),t=[];for(var r in e)r=="constructor"&&(n||!_r.call(e,r))||t.push(r);return t}function Vt(e){return dt(e)?gr(e,!0):Sr(e)}var Ir=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Er=/^\w*$/;function Tr(e,n){if(P(e))return!1;var t=typeof e;return t=="number"||t=="symbol"||t=="boolean"||e==null||ot(e)?!0:Er.test(e)||!Ir.test(e)||n!=null&&e in Object(n)}var Or=st(Object,"create"),F=Or;function xr(){this.__data__=F?F(null):{},this.size=0}function Ar(e){var n=this.has(e)&&delete this.__data__[e];return this.size-=n?1:0,n}var $r="__lodash_hash_undefined__",Nr=Object.prototype,Cr=Nr.hasOwnProperty;function Pr(e){var n=this.__data__;if(F){var t=n[e];return t===$r?void 0:t}return Cr.call(n,e)?n[e]:void 0}var jr=Object.prototype,Dr=jr.hasOwnProperty;function Br(e){var n=this.__data__;return F?n[e]!==void 0:Dr.call(n,e)}var Lr="__lodash_hash_undefined__";function Rr(e,n){var t=this.__data__;return this.size+=this.has(e)?0:1,t[e]=F&&n===void 0?Lr:n,this}function A(e){var n=-1,t=e==null?0:e.length;for(this.clear();++n<t;){var r=e[n];this.set(r[0],r[1])}}A.prototype.clear=xr;A.prototype.delete=Ar;A.prototype.get=Pr;A.prototype.has=Br;A.prototype.set=Rr;function Mr(){this.__data__=[],this.size=0}function J(e,n){for(var t=e.length;t--;)if(K(e[t][0],n))return t;return-1}var Fr=Array.prototype,qr=Fr.splice;function zr(e){var n=this.__data__,t=J(n,e);if(t<0)return!1;var r=n.length-1;return t==r?n.pop():qr.call(n,t,1),--this.size,!0}function Ur(e){var n=this.__data__,t=J(n,e);return t<0?void 0:n[t][1]}function Hr(e){return J(this.__data__,e)>-1}function Gr(e,n){var t=this.__data__,r=J(t,e);return r<0?(++this.size,t.push([e,n])):t[r][1]=n,this}function E(e){var n=-1,t=e==null?0:e.length;for(this.clear();++n<t;){var r=e[n];this.set(r[0],r[1])}}E.prototype.clear=Mr;E.prototype.delete=zr;E.prototype.get=Ur;E.prototype.has=Hr;E.prototype.set=Gr;var Kr=st(j,"Map"),Xt=Kr;function Jr(){this.size=0,this.__data__={hash:new A,map:new(Xt||E),string:new A}}function Vr(e){var n=typeof e;return n=="string"||n=="number"||n=="symbol"||n=="boolean"?e!=="__proto__":e===null}function V(e,n){var t=e.__data__;return Vr(n)?t[typeof n=="string"?"string":"hash"]:t.map}function Xr(e){var n=V(this,e).delete(e);return this.size-=n?1:0,n}function kr(e){return V(this,e).get(e)}function Wr(e){return V(this,e).has(e)}function Yr(e,n){var t=V(this,e),r=t.size;return t.set(e,n),this.size+=t.size==r?0:1,this}function O(e){var n=-1,t=e==null?0:e.length;for(this.clear();++n<t;){var r=e[n];this.set(r[0],r[1])}}O.prototype.clear=Jr;O.prototype.delete=Xr;O.prototype.get=kr;O.prototype.has=Wr;O.prototype.set=Yr;var Zr="Expected a function";function ut(e,n){if(typeof e!="function"||n!=null&&typeof n!="function")throw new TypeError(Zr);var t=function(){var r=arguments,o=n?n.apply(this,r):r[0],i=t.cache;if(i.has(o))return i.get(o);var a=e.apply(this,r);return t.cache=i.set(o,a)||i,a};return t.cache=new(ut.Cache||O),t}ut.Cache=O;var Qr=500;function to(e){var n=ut(e,function(r){return t.size===Qr&&t.clear(),r}),t=n.cache;return n}var eo=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,no=/\\(\\)?/g,ro=to(function(e){var n=[];return e.charCodeAt(0)===46&&n.push(""),e.replace(eo,function(t,r,o,i){n.push(o?i.replace(no,"$1"):r||t)}),n}),oo=ro;function io(e){return e==null?"":Rt(e)}function kt(e,n){return P(e)?e:Tr(e,n)?[e]:oo(io(e))}var so=1/0;function Wt(e){if(typeof e=="string"||ot(e))return e;var n=e+"";return n=="0"&&1/e==-so?"-0":n}function ao(e,n){n=kt(n,e);for(var t=0,r=n.length;e!=null&&t<r;)e=e[Wt(n[t++])];return t&&t==r?e:void 0}function At(e,n,t){var r=e==null?void 0:ao(e,n);return r===void 0?t:r}var co=vr(Object.getPrototypeOf,Object),Yt=co,uo="[object Object]",lo=Function.prototype,fo=Object.prototype,Zt=lo.toString,po=fo.hasOwnProperty,ho=Zt.call(Object);function yo(e){if(!D(e)||q(e)!=uo)return!1;var n=Yt(e);if(n===null)return!0;var t=po.call(n,"constructor")&&n.constructor;return typeof t=="function"&&t instanceof t&&Zt.call(t)==ho}function mo(){this.__data__=new E,this.size=0}function go(e){var n=this.__data__,t=n.delete(e);return this.size=n.size,t}function vo(e){return this.__data__.get(e)}function bo(e){return this.__data__.has(e)}var wo=200;function _o(e,n){var t=this.__data__;if(t instanceof E){var r=t.__data__;if(!Xt||r.length<wo-1)return r.push([e,n]),this.size=++t.size,this;t=this.__data__=new O(r)}return t.set(e,n),this.size=t.size,this}function B(e){var n=this.__data__=new E(e);this.size=n.size}B.prototype.clear=mo;B.prototype.delete=go;B.prototype.get=vo;B.prototype.has=bo;B.prototype.set=_o;var Qt=typeof w=="object"&&w&&!w.nodeType&&w,$t=Qt&&typeof _=="object"&&_&&!_.nodeType&&_,So=$t&&$t.exports===Qt,Nt=So?j.Buffer:void 0,Ct=Nt?Nt.allocUnsafe:void 0;function Io(e,n){if(n)return e.slice();var t=e.length,r=Ct?Ct(t):new e.constructor(t);return e.copy(r),r}var Eo=j.Uint8Array,Pt=Eo;function To(e){var n=new e.constructor(e.byteLength);return new Pt(n).set(new Pt(e)),n}function Oo(e,n){var t=n?To(e.buffer):e.buffer;return new e.constructor(t,e.byteOffset,e.length)}function xo(e){return typeof e.constructor=="function"&&!zt(e)?an(Yt(e)):{}}function Ao(e){return function(n,t,r){for(var o=-1,i=Object(n),a=r(n),s=a.length;s--;){var c=a[e?s:++o];if(t(i[c],c,i)===!1)break}return n}}var $o=Ao(),No=$o;function et(e,n,t){(t!==void 0&&!K(e[n],t)||t===void 0&&!(n in e))&&ct(e,n,t)}function Co(e){return D(e)&&dt(e)}function nt(e,n){if(!(n==="constructor"&&typeof e[n]=="function")&&n!="__proto__")return e[n]}function Po(e){return En(e,Vt(e))}function jo(e,n,t,r,o,i,a){var s=nt(e,t),c=nt(n,t),d=a.get(c);if(d){et(e,t,d);return}var u=i?i(s,c,t+"",e,n,a):void 0,l=u===void 0;if(l){var g=P(c),m=!g&&Gt(c),h=!g&&!m&&Jt(c);u=c,g||m||h?P(s)?u=s:Co(s)?u=dn(s):m?(l=!1,u=Io(c,!0)):h?(l=!1,u=Oo(c,!0)):u=[]:yo(c)||tt(c)?(u=s,tt(s)?u=Po(s):(!I(s)||it(s))&&(u=xo(c))):l=!1}l&&(a.set(c,u),o(u,c,r,i,a),a.delete(c)),et(e,t,u)}function te(e,n,t,r,o){e!==n&&No(n,function(i,a){if(o||(o=new B),I(i))jo(e,n,a,t,te,r,o);else{var s=r?r(nt(e,a),i,a+"",e,n,o):void 0;s===void 0&&(s=i),et(e,a,s)}},Vt)}var Do=$n(function(e,n,t){te(e,n,t)}),Bo=Do;function Lo(e,n,t,r){if(!I(e))return e;n=kt(n,e);for(var o=-1,i=n.length,a=i-1,s=e;s!=null&&++o<i;){var c=Wt(n[o]),d=t;if(c==="__proto__"||c==="constructor"||c==="prototype")return e;if(o!=a){var u=s[c];d=r?r(u,c,s):void 0,d===void 0&&(d=I(u)?u:at(n[o+1])?[]:{})}Ft(s,c,d),s=s[c]}return e}function Ro(e,n,t){return e==null?e:Lo(e,n,t)}function Mo(e){const n=[],t=new Proxy(e||{},{set(r,o,i){const a=k({},r);return Ro(r,o,i),n.forEach(s=>{At(r,s.key)!==At(a,s.key)&&s.callback(r,a)}),!0}});return{get(r){return t[r]},set(r,o){t[r]=o},subscribe(r,o){const i={key:r,callback:o};return n.push(i),{unsubscribe:()=>{const a=n.indexOf(i);a>-1&&n.splice(a,1)}}}}}const Fo="tick:error";class qo extends G{constructor(t){var r;super();p(this,"systems",{});p(this,"components",{});p(this,"componentInstances",{});p(this,"entities",{});p(this,"state");this.options=t,this.state=Mo((r=this.options)==null?void 0:r.state)}archetype(t){return new Ie(t,this)}registerComponents(t){for(const r of Object.values(t))this.registerComponent(r)}registerComponent(t){if(this.components[t.componentName])throw new Error(`World: component ${t.componentName} is already added`);return this.components[t.componentName]=t,this}unregisterComponent(t){for(const r of Object.values(this.entities))this.removeComponentFromEntity({componentName:t,entityId:r.id});delete this.components[t]}addComponentToEntity(t){const r=this.components[t.componentName];if(!r)throw new Error(`World: component ${String(t.componentName)} not found`);const o=new r(t,this);return t.importData&&o.importData(t.data),this.componentInstances[o.id]=o,this.emit("component:add",t),this}getComponent(t){return this.components[t]}removeComponentFromEntity(t){const r=t.componentId||rt({componentName:t.componentName,entityId:t.entityId});return this.componentInstances[r]?(this.componentInstances[r].dispose(),this.emit("component:remove",t),!0):!1}addSystems(t){for(const r of Object.values(t))this.addSystem(r)}addSystem(t,r){const o=new t(this,r);return this.systems[o.opt.name]=o,this}getSystem(t){return this.systems[t]}sortSystems(t=Object.values(this.systems)){const r=[],o=[],i=[],a=t.reduce((s,c)=>{const d=c.opt.name;return c.opt.beforeAll?(o.push(d),s):c.opt.afterAll?(i.push(d),s):(c.opt.updateBefore?s.push([d,c.opt.updateBefore]):c.opt.updateAfter?s.push([c.opt.updateAfter,d]):r.push(d),s)},[]);return{beforeAll:o,afterAll:i,orderedSystems:Se(a),systems:r}}async tick(){const t=Dt();this.emit("tick:before",{tickId:t,timestamp:Date.now()});const r=this.sortSystems(),o=r.beforeAll.map(async s=>this.runSystem(s,t));await Promise.allSettled(o);const i=r.systems.map(async s=>this.runSystem(s,t));Promise.allSettled(i);for(const s of r.orderedSystems)await this.runSystem(s,t);const a=r.afterAll.map(async s=>this.runSystem(s,t));await Promise.allSettled(a),this.emit("tick:after",{tickId:t,timestamp:Date.now()})}async runSystem(t,r){var o;try{return await((o=this.getSystem(t))==null?void 0:o.run())}catch(i){return this.emit(Fo,{error:i,systemName:t,tickId:r,timestamp:Date.now()}),null}}exportEntities(){return Object.values(this.entities).map(t=>this.exportEntity(t))}exportEntity(t){const r=t.components.map(o=>{const i=this.componentInstances[o];return{componentName:i.componentName,data:i.exportData()}});return{id:t.id,tags:t.opt.tags,components:r}}loadEntities(t){for(const r of t)this.addEntity(pt(k({},r),{importData:!0}))}addEntity(t){const r=new Ee(t,this);return this.entities[r.id]=r,r.init(),this.emit("entity:add",{entity:r}),r}removeEntityByTags(t){for(const r of Object.values(this.entities))yt(t,r.opt.tags||[])&&this.removeEntityById(r.id);return this}removeEntityById(t){if(this.entities[t]){const r=this.entities[t].opt.tags;delete this.entities[t],this.emit("entity:remove",{id:t,tags:r})}return this}findEntityById(t){return this.entities[t]}*queryComponents(t){for(const r of Object.values(this.entities)){const o=r.findComponents(t);o.filter(i=>!!i).length===t.length&&(yield o)}}queryEntitiesByTags(t){return Object.values(this.entities).reduce((r,o)=>(yt(t,o.opt.tags||[])&&r.push(o),r),[])}queryEntitiesByIds(t){return t.map(r=>this.entities[r])}queryEntitiesByComponents(t){return Object.values(this.entities).reduce((r,o)=>(o.findComponents(t).filter(a=>!!a).length===t.length&&r.push(o),r),[])}}class ${constructor(n,t){p(this,"id");p(this,"componentName");p(this,"data");p(this,"entityId");var r;this.world=t,this.entityId=n.entityId,this.componentName=this.constructor.componentName,this.id=rt({componentName:this.componentName,entityId:this.entityId}),this.setData(n.data,!0),(r=this.init)==null||r.call(this)}importData(n){this.data=n}exportData(){return this.data}setData(n,t=!1){t?this.data=n:Bo(this.data,n);const r=this.world.findEntityById(this.entityId);r?r.updated=!0:console.warn(`entity ${this.entityId} not found`)}dispose(){delete this.world.componentInstances[this.id]}}p($,"componentName");class ee extends ${init(){var n,t;this.data=this.data||{type:"session"},(t=(n=this.data).type)!=null||(n.type="session")}}p(ee,"componentName","initStorage");class ne extends ${init(){var n,t;this.data=this.data||{type:"session"},(t=(n=this.data).type)!=null||(n.type="session")}}p(ne,"componentName","storage");class re extends ${}p(re,"componentName","create");class oe extends ${}p(oe,"componentName","remove");class ie extends ${}p(ie,"componentName","toDoItem");class se extends ${}p(se,"componentName","toDoList");const zo={create:re,toDoItem:ie,toDoList:se,storage:ne,initStorage:ee,remove:oe},Uo=(e,n)=>{n.addEntity({components:[{componentName:"toDoItem",data:{content:e,createdAt:new Date().toISOString(),status:"pending"}},{componentName:"storage",data:{type:"local"}}]})},Ho=e=>{e.addEntity({id:"initStorage",components:[{componentName:"initStorage",data:{type:"local"}}]})},Go=e=>{e.addEntity({id:"search-field",components:[{componentName:"create",data:{nodeSelector:".create-container"}}]})},Ko=e=>{e.addEntity({id:"todo-list",components:[{componentName:"toDoList",data:{renderType:"all",container:".todo-list-items"}},{componentName:"storage",data:{type:"local"}}]})};class lt extends G{constructor(t){super();p(this,"storage",localStorage);p(this,"prefix");this.collectionName=t,this.prefix=`ecs.${this.collectionName}`}getId(t){return`${this.prefix}.${t}`}async get(t){const r=this.storage.getItem(this.getId(t));return r&&JSON.parse(r)}async set(t,r){this.storage.setItem(this.getId(t),JSON.stringify(r)),this.emit("add",{id:t,val:r})}async remove(t){return this.storage.removeItem(this.getId(t)),this.emit("remove",{id:t}),!0}async query(t={}){const r=new RegExp(this.prefix);return Object.keys(this.storage).reduce((o,i)=>{if(!r.test(i))return o;const a=JSON.parse(this.storage.getItem(i));return(Object.keys(t).length===0||this.matchValues(t,a))&&o.push(a),o},[])}matchValues(t={},r){return Object.keys(t).every(o=>t[o]===r[o])}}class ae extends G{constructor(t){super();p(this,"data",{});this.collectionName=t}async get(t){return this.data[t]}async set(t,r){this.data[t]=r,this.emit("add",{id:t,val:r})}async remove(t){return delete this.data[t],this.emit("remove",{id:t}),!0}async query(t={}){return Object.keys(this.data).reduce((r,o)=>{const i=this.data[o];return(Object.keys(t).length===0||this.matchValues(t,i))&&r.push(i),r},[])}matchValues(t={},r){return Object.keys(t).every(o=>t[o]===r[o])}}class ce extends lt{constructor(){super(...arguments);p(this,"storage",sessionStorage)}}class z{constructor(n,t){this.world=n,this.opt=t}async run(){var n,t;await((n=this.preUpdate)==null?void 0:n.call(this));for(const r of this.queryComponents())try{await this.update(r)}catch(o){console.error(o.message,o.stack),this.world.emit("system:error",{systemName:this.opt.name,components:r})}await((t=this.postUpdate)==null?void 0:t.call(this))}queryComponents(){return this.world.queryComponents(this.opt.componentNames)}}class Jo extends z{constructor(t){super(t,{componentNames:["initStorage"],name:"initStorage",updateBefore:"storage",beforeAll:!0});p(this,"storage",{memory:new ae("entity"),session:new ce("entity"),local:new lt("entity")})}async update([t]){if(!t)return;const r=this.world.findEntityById(t.entityId),o=this.storage[t.data.type];t.data.initialized||(this.world.loadEntities(await o.query()),t.data.initialized=!0,t.setData({initialized:!0}),r.dispose(),this.world.tick())}}class Vo extends z{constructor(t){super(t,{componentNames:["storage"],name:"storage"});p(this,"storage",{memory:new ae("entity"),session:new ce("entity"),local:new lt("entity")})}async update([t]){if(!t)return;const r=this.world.findEntityById(t.entityId),o=this.storage[t.data.type];if(o){if(t.data.toBeRemoved){await o.remove(r.id);return}r!=null&&r.updated&&(await o.set(r.id,this.world.exportEntity(r)),r.updated=!1)}}}class Xo extends z{constructor(n){super(n,{componentNames:["create"],name:"creation"}),this.world=n}async update([n]){var t,r,o;n.data.node=n.data.node||((r=(t=this.world.options)==null?void 0:t.screen)==null?void 0:r.querySelector(n.data.nodeSelector)),n.data.node&&!((o=n.data.node)!=null&&o.classList.contains("initialized"))&&(n.data.node.innerHTML=`
      <div class="input-group">
        <input type="text" class="form-control creation-input" placeholder="to do content" aria-label="to do content">
        <button class="btn btn-outline-secondary submit-btn" type="button" id="button-addon2">Add</button>
      </div>`,n.data.node.classList.add("initialized"),n.data.node.querySelector(".submit-btn").addEventListener("click",i=>{var s;console.log(i);const a=(s=n.data.node)==null?void 0:s.querySelector(".creation-input").value;console.log("val",a),a&&(Uo(a,this.world),this.world.tick())}))}}class ko extends z{constructor(n){super(n,{componentNames:["toDoItem","remove"],name:"remove",afterAll:!0}),this.world=n}async update([,n]){const t=this.world.findEntityById(n.entityId);!t||(t.dispose(),await this.world.tick())}}function Q(e,n,t,r){const o=i=>{var s;const a=(s=i.target)==null?void 0:s.closest(n);a&&r(a)};return t.addEventListener(e,o),function(){t.removeEventListener(e,o)}}class Wo extends z{constructor(t){super(t,{componentNames:["toDoList"],name:"toDoList",updateBefore:"storage"});p(this,"toDoItemsArchType");this.world=t,this.toDoItemsArchType=this.world.archetype(["toDoItem"])}container(t){var r,o;return(o=(r=this.world.options)==null?void 0:r.screen)==null?void 0:o.querySelector(t)}async update([t]){if(!this.world.findEntityById(t.entityId))return;if(!this.container(t.data.container)){console.warn("toDoListSystem: container not found");return}this.renderContainer(t),this.renderToDoItems(t)}getItemsNode(t){const r=this.container(t);return r==null?void 0:r.querySelector(".to-do-list-items")}renderContainer(t){const r=this.container(t.data.container);if(!r){console.warn("toDoListSystem: container not found");return}let o=r.querySelector(".to-do-list-action");const i=t.data.renderType;if(o)o.setAttribute("data-type",i);else{r.innerHTML=`
        <div class="to-do-list-action btn-group" data-type="${i}">

        </div>
        <ul class="to-do-list-items list-group"></ul>
      `;const d=r.querySelector(".to-do-list-items");o=r.querySelector(".to-do-list-action"),Q("click",".btn",o,u=>{console.log("node",u);const l=u.getAttribute("data-type");t.setData({renderType:l}),this.world.tick()}),Q("click",'input[type="checkbox"]',d,u=>{console.log("node",u,u.checked);const l=u.parentElement.getAttribute("data-id");this.world.findEntityById(l).findComponents(["toDoItem"])[0].setData({status:u.checked?"completed":"pending"}),this.world.tick()}),Q("click","button.btn-remove-item",d,u=>{const l=u.parentElement.getAttribute("data-id"),g=this.world.findEntityById(l);g.addComponent({componentName:"remove"});const[m]=g.findComponents(["storage"]);m.setData({toBeRemoved:!0}),this.world.tick()})}const a=i==="all"?"active":"",s=i==="pending"?"active":"",c=i==="completed"?"active":"";o.innerHTML=`<button type="button" class="btn btn-outline-secondary all-btn ${a}" type="submit" data-type="all">All</button>
    <button type="button" class="btn btn-outline-secondary pending-btn ${s}" type="submit" data-type="pending">Pending</button>
    <button type="button" class="btn btn-outline-secondary completed-btn ${c}" type="submit" data-type="completed">Completed</button>`}sortEntities(){return[...this.toDoItemsArchType.entityIds].sort((t,r)=>{const o=this.world.findEntityById(t),i=this.world.findEntityById(r),[a]=o.findComponents(["toDoItem"]),[s]=i.findComponents(["toDoItem"]);return new Date(a.data.createdAt)>new Date(s.data.createdAt)?1:-1})}renderToDoItems(t){const r=this.getItemsNode(t.data.container);for(const i of this.sortEntities()){const a=this.world.findEntityById(i);if(!a)continue;const c=a.findComponents(["toDoItem"])[0],d=t.data.renderType,u=this.findNodeById(i,r);if(d!=="all"&&c.data.status!==d){u==null||u.remove();continue}this.renderItem(c,u,r,i)}this.findNodes(r).forEach(i=>{const a=i.getAttribute("data-id");a&&!this.toDoItemsArchType.entityIds.has(a)&&i.remove()})}renderItem(t,r,o,i){const a=t.data.status==="completed"?"checked":"";r?(r.classList[a?"add":"remove"]("checked"),r.querySelector("input")[a?"setAttribute":"removeAttribute"](a,"")):(o==null||o.insertAdjacentHTML("beforeend",`<li class="list-group-item d-flex to-do-list-item ${a}" data-id=${i}>
            <input class="form-check-input me-2" type="checkbox" ${a}>
            <span class="to-do-list-content">${t.data.content}</span>
            <button type="button" class="btn btn-outline-danger btn-remove-item">Remove</button>
          </li>`),r=this.findNodeById(i,o))}findNodeById(t,r){return r==null?void 0:r.querySelector(`.to-do-list-item[data-id="${t}"]`)}findNodes(t){return t?Array.from(t.querySelectorAll(".to-do-list-item[data-id]")||[]):[]}}const Yo={creation:Xo,toDoList:Wo,initStorage:Jo,storage:Vo,remove:ko};class Zo extends HTMLElement{constructor(){super();p(this,"world");this.world=new qo({screen:this}),this.registerComponents(),this.registerSystems()}connectedCallback(){this.innerHTML=`<div class="todo-list-container">
      <div class="create-container"></div>
      <div class="todo-list-items"></div>
    </div>`,Ho(this.world),Go(this.world),Ko(this.world),this.world.tick()}registerComponents(){this.world.registerComponents(zo)}registerSystems(){this.world.addSystems(Yo)}}customElements.define("todo-list",Zo)});export default Qo();
